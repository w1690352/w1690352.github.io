<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="Content-Security-Policy: script-src https://cdn.example.com/scripts/; object-src 'none'">
<script src="https://code.jquery.com/jquery-1.12.4.js"></script> 
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<link href="https://fonts.googleapis.com/css?family=Alatsi|Muli&display=swap" rel="stylesheet">
<link href="articleCSS.css" rel="stylesheet" type="text/css">
<title>Articles</title>
</head>
<body>
<!-- Div where the next and previous buttons are displayed and later the rating-->
<div id="BTNS">
	<!-- no action is implemented as specified in specs-->
	<form method="post" id="ratingForm">
  <h3 id="BTNStitle"></h3>
  <div id="myRating">
	<p id="myRatingText">
	  </p>
	</div>
  
	</form>
	<div id="BTNDIV">
    <button id="prevBTN" class="BTNS">Previous Article</button>
    <button id="nextBTN" class="BTNS">Next Article</button>
 	</div>
</div>
<!-- Div all will show the current article-->
<div id="all"> </div>
<!-- Div displayAll will later store and show all articles in small version-->	
<div id="displayAll"></div>
<script>
	
	
	$(document).ready(function(){
		
		var currentArticle = 0;
		
		$("#nextBTN").click(function(){
			// Every time the user clickes next the current article counter will increase and call the displayArticle function
			if (currentArticle<5){
			currentArticle++;
			displayArticle(currentArticle);}
			// if cuurent article is 5 meaning we have showen the user all the different articles then a diffrent functionis called
			else if (currentArticle==5){
				currentArticle++;
				printArticle();
			}
		});
		
		$("#prevBTN").click(function(){
			// As long as its not 1 or 0 the current aticled decreases and calls the function to display the correct article
			if(currentArticle>1){
			currentArticle--;
			displayArticle(currentArticle);}
		});
		
		
		function displayArticle (currentArticle){
			//calles the function to display the right article
			if (currentArticle == 1){
				displayArticle1();
			}
			else if(currentArticle == 2){
				displayArticle2();
			}
			else if(currentArticle == 3){
				displayArticle3();
			}
			else if(currentArticle == 4){
				displayArticle4();
			}
			else if(currentArticle == 5){
				displayArticle5();
			}
		}
		
		//each article is styled differently so they each have their own function
		
		function displayArticle1(){
			$("#all").empty();
			
			//get correct json Name
			var nameOfJson = "article";
			nameOfJson+=currentArticle;
			nameOfJson+=".json"
			
			//create a XMLHttpRequest() to GET the json
			req=new XMLHttpRequest();
    		req.open("GET",nameOfJson,true);
    		req.send();
    		req.onload=function()
			{
				json=JSON.parse(req.responseText);
				
				//once the json is uploaded build the html of the article within var output
	
				document.getElementsByTagName("title")[0].innerHTML = json.title;
				var output="";
				output+=" <header>";
				output+=" <div id='topSection'>";
				//get the article heading from the json
				output+=" <h1 id=heading'>"+json.heading+"</h1>";
				output+=" </div>";
				output+=" </header>";
				output+=" <div class='text' id='firstPara'>";
				output+=" <p id='paragraph1' class='paragraph'>"+json.paragraph1+"</p>";
				output+=" </div>";
				output+=" <div class='images'>";	
				// get all image attributes from json
				output+=" <div class='biggerIMG'> <img alt='"+json.alttext+"' src='"+json.image+"?sig="+Math.random()+"' id='Image1'> </div>";
				output+=" </div>";
				output+="  <div class='text'>";
				output+="  <p id=paragraph2'  class='paragraph'>"+json.paragraph2+"</p>";
				output+=" <br><br>";
				output+="  <p id=paragraph3'  class='paragraph'>"+json.paragraph3+"</p>";
				var list="<ul>"
				for(var i in json.list){
								list+="<li>"+json.list[i]+"</li>";
						}
						list+="</ul>"
				output+=" <div id='list'>"+list+"</div>";
				// append the output to the all div so the article is displayed
				$("#all").append(output);
				
    		};
		};
		
		function displayArticle2(){
			$("#all").empty();
			
			//get correct json Name
			var nameOfJson = "article";
			nameOfJson+=currentArticle;
			nameOfJson+=".json"
			
			//create a XMLHttpRequest() to GET the json
			req=new XMLHttpRequest();
    		req.open("GET",nameOfJson,true);
    		req.send();
    		req.onload=function()
			{
				json=JSON.parse(req.responseText);
	
				//once the json is uploaded build the html of the article within var output
				document.getElementsByTagName("title")[0].innerHTML = json.title;
				var output="";
				output+=" <header>";
				output+=" <div id='topSection'>";
				output+=" <h1 id=heading'>"+json.heading+"</h1>";
				output+=" </div>";
				output+=" </header>";
				output+=" <div class='text' id='firstPara'>";
				output+=" <p id='paragraph1' class='paragraph'>"+json.paragraph1+"</p>";
				output+=" </div>";
				output+=" <div class='images'>";	
				output+=" <div class='biggerIMG'> <img alt='"+json.alttext+"' src='"+json.image+"?sig="+Math.random()+"' id='Image1'> </div>";
				output+=" </div>";
				output+="  <div class='text'>";
				output+="  <p id=paragraph2'  class='paragraph'>"+json.paragraph2+"</p>";
				output+=" <br><br>";
				output+="  <p id=paragraph3'  class='paragraph'>"+json.paragraph3+"</p>";
				output+=" <br><br>";
				output+="  <p id=paragraph4'  class='paragraph'>"+json.paragraph4+"</p>";
				output+=" <br><br>";
				output+="  <p id=paragraph5'  class='paragraph'>"+json.paragraph5+"</p>";
				output+=" </div>"
				output+=" <div class='images'>";	
				output+=" <div class='biggerIMG'> <img alt='"+json.alttext2+"' src='"+json.image2+"?sig="+Math.random()+"' id='Image2'> </div>";
				output+=" </div>";
				output+="  <div class='text'>";
				output+="  <p id=paragraph6'  class='paragraph'>"+json.paragraph6+"</p>";
				output+=" </div>";
				output+=" <div class='images'>";	
				output+=" <div class='biggerIMG'> <img alt='"+json.altText3+"' src='"+json.image3+"?sig="+Math.random()+"' id='Image3'> </div>";
				output+=" </div>";
				output+="  <div class='text'>";
				output+="  <p id=paragraph7'  class='paragraph'>"+json.paragraph7+"</p>";
				output+=" </div>";
				// append the output to the all div so the article is displayed
				$("#all").append(output);
				
    		};
		}
		
		function displayArticle3(){
			$("#all").empty();
			
			//get correct json Name
			var nameOfJson = "article";
			nameOfJson+=currentArticle;
			nameOfJson+=".json"
			//create a XMLHttpRequest() to GET the json
			req=new XMLHttpRequest();
    		req.open("GET",nameOfJson,true);
    		req.send();
    		req.onload=function()
			{
				json=JSON.parse(req.responseText);
				//once the json is uploaded build the html of the article within var output
				document.getElementsByTagName("title")[0].innerHTML = json.title;
				var output="";
				output+=" <header>";
				output+=" <div id='topSection'>";
				output+=" <h1 id=heading'>"+json.heading+"</h1>";
				output+=" </div>";
				output+=" </header>";
				output+=" <div class='text' id='firstPara'>";
				output+=" <p id='paragraph1' class='paragraph'>"+json.paragraph1+"</p>";
				output+=" </div><div class= 'text'>";
				output+="  <p id=paragraph2'  class='paragraph'>"+json.paragraph2+"</p>";
				output+=" <br><br>";
				output+="  <p id=paragraph3'  class='paragraph'>"+json.paragraph3+"</p>";
				output+=" <br><br>";
				output+="  <p id=paragraph4'  class='paragraph'>"+json.paragraph4+"</p>";
				output+=" <br><br>";
				output+="  <p id=paragraph5'  class='paragraph'>"+json.paragraph5+"</p>";
				output+=" <br><br>";
				output+="  <p id=paragraph6'  class='paragraph'>"+json.paragraph6+"</p>";
				output+=" <br><br>";
				output+="  <p id=paragraph7'  class='paragraph'>"+json.paragraph7+"</p>";
				output+=" <br><br>";
				output+="  <p id=paragraph8'  class='paragraph'>"+json.paragraph8+"</p>";
				output+=" </div>";
				// append the output to the all div so the article is displayed
				$("#all").append(output);
				
    		};
		}	
		
		function displayArticle4(){
			$("#all").empty();
			
			//get correct json Name
			var nameOfJson = "article";
			nameOfJson+=currentArticle;
			nameOfJson+=".json"
			
			//create a XMLHttpRequest() to GET the json
			req=new XMLHttpRequest();
    		req.open("GET",nameOfJson,true);
    		req.send();
    		req.onload=function()
			{
				json=JSON.parse(req.responseText);
				//once the json is uploaded build the html of the article within var output
				document.getElementsByTagName("title")[0].innerHTML = json.title;
				var output="";
				output+=" <header>";
				output+=" <div id='topSection'>";
				output+=" <h1 id=heading'>"+json.heading+"</h1>";
				output+=" </div>";
				output+=" </header>";			
				output+=" <div class='text' id='firstPara'>";
				output+=" <p id='paragraph1' class='paragraph'>"+json.paragraph1+"</p>";
				output+=" </div>";
				var list="<ul>"
				for(var i in json.list){
								list+="<li>"+json.list[i]+"</li>";
						}
						list+="</ul>"
				output+=" <div id='list'>"+list+"</div>";
				output+="  <div class='text'>";
				output+="  <p id=paragraph2'  class='paragraph'>"+json.paragraph2+"</p>";
				output+=" </div>";
				var list2="<ul>"
				for(var i in json.list2){
								list2+="<li>"+json.list2[i]+"</li>";
						}
						list2+="</ul>"
				output+=" <div id='list2'>"+list2+"</div>";
				output+="  <div class='text'>";
				output+="  <p id=paragraph3'  class='paragraph'>"+json.paragraph3+"</p>";
				output+=" </div>";
				// append the output to the all div so the article is displayed
				$("#all").append(output);
				
    		};
		};
		
		function displayArticle5(){
			$("#all").empty();
			
			//get correct json Name
			var nameOfJson = "article";
			nameOfJson+=currentArticle;
			nameOfJson+=".json"
			
			//create a XMLHttpRequest() to GET the json
			req=new XMLHttpRequest();
    		req.open("GET",nameOfJson,true);
    		req.send();
    		req.onload=function()
			{
				json=JSON.parse(req.responseText);
				//once the json is uploaded build the html of the article within var output
				document.getElementsByTagName("title")[0].innerHTML = json.title;
				var output="";
				output+=" <header>";
				output+=" <div id='topSection'>";
				output+=" <h1 id=heading'>"+json.heading+"</h1>";
				output+=" </div>";
				output+=" </header>";	
				output+=" <div class='images'>";	
				output+=" <div class='biggerIMG'> ";
				output+=" <img alt='"+json.alttext+"' src='"+json.image+"?sig="+Math.random()+"' id='Image1'> ";
				output+=" <img alt='"+json.alttext2+"' src='"+json.image2+"?sig="+Math.random()+"' id='Image2'> ";
				output+=" </div>";
				output+=" </div>";
				output+=" <div class='text' id='firstPara'>";
				output+=" <p id='paragraph1' class='paragraph'>"+json.paragraph1+"</p>";
				output+=" </div>";
				
				// append the output to the all div so the article is displayed
				$("#all").append(output);
				
    		};
		};
		
		//after all 5 articles have been showen show all articles in small format
		function printArticle(){
			
				$("#all").empty();
						
				//GET the json file with all articles	
				reqNew=new XMLHttpRequest();
    			reqNew.open("GET","articles.json",true);
    			reqNew.send();
    			reqNew.onload=function()
				{
						jsonNew=JSON.parse(reqNew.responseText);
						var output="";
						output+="<div class='smallArticleDiv'>";
						output+="<div class='textInVisible'>"
						output+="<h1 class='title'> All articles, drag to re-order </h1>";
						output+="</div>";
						output+="</div>";
						output+="<ul id=sortable>"
						// loop through the articles array in the json and create each article in html
						for (var currentArticleToPrint=0; currentArticleToPrint<5 ; currentArticleToPrint++)
						{
							output+="<li id='"+jsonNew.articles[currentArticleToPrint].id+"'>"
							output+="<div class='smallArticleDiv' id='"+jsonNew.articles[currentArticleToPrint].id+"'>";
							output+="<div class='mainPageIMGDIV'>"
							//not all articles contain an image
							if(jsonNew.articles[currentArticleToPrint].image!=undefined)
							{
							output+="<img class='mainPageIMG' src='"+jsonNew.articles[currentArticleToPrint].image+"?sig="+Math.random()+"'>";
							}
							output+="</div>";
							output+="<div class='textInVisible'>"
							output+="<h1 class='title'>"+jsonNew.articles[currentArticleToPrint].title+"</h1>";
							output+="<p class='heading'>"+jsonNew.articles[currentArticleToPrint].heading+"</p>";
							output+="<p class='paragraph1'>"+jsonNew.articles[currentArticleToPrint].paragraph1+"...</p>";
							output+="</div></div>"
							output+="</li>"
						}
						output+="</ul>"
						//add the output to displayall div
						$("#displayAll").append(output);
						//call to function that sets up the sortable funcitonality
						getSortableReady();
				}

		}
		
		
		function getSortableReady(){
			//remove the next and previous buttons and add a title and new submit button
			$("#BTNStitle").append("Current ranking:");
			$("#nextBTN").remove();
			$("#prevBTN").remove();
			var newBTN = "<button type='submit' class='BTNS' id='submitBTN' form='ratingForm'>Submit Rating</button>";
			$("#BTNDIV").append(newBTN);
			//make the articles sortable and call a function everytime the user updates the order
			$("#sortable").sortable({
				update: function(event, ui) {
					getRating();}
			});
			$("#sortable" ).disableSelection();
			//get the initial rating 
			getRating();
			
		}
		
		function getRating(){
			$("#myRatingText").empty();
			// get the order of the articles
			var divOrder = $('#sortable').sortable("toArray");
			var orderDisply="";
			var listNum = 0;
			for(i in divOrder){
				listNum++;
				// add the article names
				orderDisply+="<div class='articleInRating'><h3>"+listNum+". ";
				orderDisply+=divOrder[i];
				orderDisply+="</h3></div>";
				orderDisply+="<input type='hidden' name='number"+listNum+"' value="+divOrder[i]+">"
				
			}
			$("#myRatingText").append(orderDisply);
		}		
		
  });
	
	</script>
<footer> 
  <p> Tair Doron    |  <telephone>07592396425</telephone>| <a href="mailto:tairdoron@me.com"> tairdoron@me.com </a> </p>
</footer>
</body>
</html>
